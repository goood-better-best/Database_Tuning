[TOC]



# 인덱스 기본

- 인덱스 탐색 과정이 수직적 탐색과 수평적 탐색, 두 단계로 이루어진다는 사실을 기억하자





## 2.1 인덱스 구조 및 탐색

- 어떤 초등학교에서 '홍길동'이라는 학생을 찾는 방법은?

  - 1. 1학년 1반부터 6학년 마지막 반까지 돌아다니며 홍길동 학생을 찾는다.
    2. 교무실에서 학생 명부를 조회해 홍길동 학생이 있는 교실만 찾아간다.

    

  - 홍길동 학생이 많다면 전자가, 적다면 후자가 빠르다.



- 만약 이름으로 학생을 찾는 경우가 많다면 학생명부를 이름순으로 정렬해두면 편할 것이다.

  - 여기서 이름이 인덱스이다.

  - 학년-반-번호는 각 학생마다 갖는 고유한 속성이고 이것은 인덱스 ROWID이다.



- DB또한 두가지 방법으로 테이블에서 데이터를 찾는다.
  - 테이블 전체 스캔
  - 인덱스 이용



- 인덱스의 핵심 요소
  - 인덱스는 큰 테이블에서 소량 데이터를 검색할 때 사용함
  - 온라인 트랜잭션 처리는 주로 소량 데이터 검색임
  - 그러니 인덱스 튜닝이 중요함
  - 핵심 요소 두가지는 다음과 같다
    - 인덱스 스캔 과정에서 발생하는 비효율 줄이기
    - 테이블 엑세스 횟수 줄이기



- 인덱스 스캔 과정에서 발생하는 비효율 줄이기?
  - '김'씨인 학생중 키가 '170' 이상인 학생을 찾고 싶다고 해보자
  - 만약 이름-키 순으로 정렬이 되어있다면 소량만 스캔해서 결과를 찾을 수 있다.
  - 그러나 키-이름 순으로 정렬되어 있다면 더 많은 양을 스캔해야만 찾을 수 있다.



- 테이블 엑세스 횟수를 줄인다?
  - 인덱스 스캔 후 테이블 레코드를 엑세스할 때(= 읽을 때) 랜덤 I/O 방식을 사용하므로 이를 '랜덤 엑세스 최소화 튜닝'이라 한다.
  - '김'씨 학생은 10명이고 키가 170 이상인 학생은 50명이다.
  - 그 중에 170이 넘는 김씨는 3명 뿐이라 해보자.
  - 만약 '이름'만으로 정렬한 학생명부 vs '키'만으로 정렬할 학생명부만 있다고 생각해보자
  - '이름'으로 정렬된 학생명부에서 인덱스는 이름이고, 명부를 보고 반(테이블)을 방문해야만 키를 확인 할 수 있게된다. 반대의 경우도 마찬가지다.
  - 그렇다면 '이름'으로 정렬한 학생명부가 있다면 테이블을 10번만 방문하면 된다. (모든 김씨 체크)
  - 그러나 키로 정렬한 학생명부로 방문한다면 50번을 방문해야 한다.





- 인덱스 스캔 효율화 튜닝과 랜덤 액세스 최소화 튜닝 중 랜덤 엑세스 최소화 튜닝이 좀더 중요하다고 할 수 있다.
  - 테이블을 직접 찾아가는 비율을 줄여야하기 때문이다.



- SQL 튜닝은 랜덤 I/O 와의 전쟁이다.





### **인덱스 구조**

- 데이터베이스에서 인덱스 없이 데이터를 찾으려면 테이블 전체를 스캔해야한다.
  - 반면, 인덱스를 이용하면 일부만 스캔하고 멈출 수 있다.
  - 범위 스캔이 가능하다는 의미이다.
  - 범위 스캔이 가능한 이유는 인덱스가 **정렬** 되어있기 때문이다.



- DBMS는 일반적으로 B*Tree 인덱스를 사용한다

  - B*Tree 인덱스를 사용하는 이유

    https://helloinyong.tistory.com/296



![비트리](https://miro.medium.com/max/1838/1*IteSc8bf_UvedJ1wL-wDyg.jpeg)

- 리프 블록에 저장된 각 레코드는 키값 순으로 정렬되어 있고 ROWID를 가짐
  - 키가 같다면 ROWID 순으로 정렬됨
  - 인덱스를 스캔하는 이유는 소량의 데이터를 빨리 찾고 거기서 ROWID를 찾기 위함이다.



- 데이터 구조
  - ROWID = 데이터 블록 주소 + 로우 번호
  - 데이터 블록 주소 = 데이터 파일 번호 + 블록 번호
  - 블로 번호 : 데이터파일 내에서 부여한 상대적 순번
  - 로우 번호 : 블록 내 순번



- 인덱스 탐색의 두가지 방법
  - 수직적 탐색 : 인덱스 스캔 시작지점을 찾는 과정
  - 수평적 탐색 : 데이터를 찾는 과정





### **수직적 탐색 **

- 인덱스 스캔의 시작지점을 찾는 작업





### **수평적 탐색 **

- 수직적 탐색을 통해 스캔 시작점을 찾으면 찾고자 하는 데이터가 더 나타나지 않을 때 까지 인덱스 리프 블록을 수평적으로 스캔함



- 본격적으로 데이터를 찾는 과정임

![탐색](https://mblogthumb-phinf.pstatic.net/20160121_46/xxsaintxx_1453363988910UceD2_JPEG/1.jpg?type=w2)



- 수평적 탐색이 끝나면 만족하는 모든 데이터를 찾으면서 ROWID를 얻어온다.
  - 인덱스로 끝나는 경우도 있지만 일반적으로 ROWID로 테이블 엑세스함



### **결합 인덱스 구조와 탐색**

- 두가지 이상 조건을 가지고 탐색하는 경우이다.
- 앞서 말했던 이름-키, 혹은 키-이름 순으로 인덱스를 만들었을 때의 차이가 여기서 나타난다.
- 그러나 단순한 엑셀 평면구조와는 다르게 다단계구조이다.
  - 엑셀은 이름과 키를 필터링하면 바로 구분해서 보여준다.
  - 그러나 DBMS는 '이름'과 '키'를 동시에 가지고 찾아다닌다.
  - 엑셀은 하나씩 정렬하여 확인할 수 있지만 DBMS는 두가지 요소를 같이 들고 찾아다닌다.





## 2.2 인덱스 기본 사용법



## 2.3 인덱스 확장기능 사용법

